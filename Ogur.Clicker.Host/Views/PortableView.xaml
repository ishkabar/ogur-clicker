<!-- Ogur.Clicker.Host/Views/PortableView.xaml -->
<Window x:Class="Ogur.Clicker.Host.Views.PortableView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Ogur.Clicker.Host.Converters"
        Title="Ogur Clicker - Portable"
        Width="400"
        Height="80"
        MinWidth="200"
        MinHeight="60"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        Topmost="{Binding IsAlwaysOnTop}">

    <Window.Resources>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
    </Window.Resources>

    <Border x:Name="MainBorder"
            Background="#2D2D30"
            BorderBrush="#007ACC"
            BorderThickness="1"
            CornerRadius="4"
            Padding="4"
            MouseLeftButtonDown="Draggable_MouseLeftButtonDown">
        <Grid MouseLeftButtonDown="Draggable_MouseLeftButtonDown">
            <!-- Slots - Horizontal Scrollable -->
            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Disabled"
                         MouseLeftButtonDown="Draggable_MouseLeftButtonDown">
                <ItemsControl ItemsSource="{Binding Slots}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"
                                       MouseLeftButtonDown="Draggable_MouseLeftButtonDown"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#3C3C3C"
                                    BorderBrush="#555"
                                    BorderThickness="1"
                                    CornerRadius="2"
                                    Margin="2"
                                    Padding="6,4"
                                    MinWidth="40"
                                    MinHeight="40">
                                <Viewbox Stretch="Uniform">
                                    <StackPanel Orientation="Vertical"
                                               HorizontalAlignment="Center"
                                               Width="40"
                                               Height="40">
                                        <!-- Key Name -->
                                        <TextBlock Text="{Binding KeyName}"
                                                  Foreground="White"
                                                  FontWeight="Bold"
                                                  FontSize="12"
                                                  HorizontalAlignment="Center"
                                                  Margin="0,0,0,4"/>

                                        <!-- Status Indicator -->
                                        <Ellipse Width="16" Height="16"
                                                HorizontalAlignment="Center"
                                                ToolTip="{Binding StatusTooltip}">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Setter Property="Fill" Value="#555"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ExecutionStatus}" Value="Ready">
                                                            <Setter Property="Fill" Value="#00FF00"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ExecutionStatus}" Value="Executing">
                                                            <Setter Property="Fill" Value="#FF0000"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ExecutionStatus}" Value="NoFocus">
                                                            <Setter Property="Fill" Value="#555"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>
                                    </StackPanel>
                                </Viewbox>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Controls - Top Right Corner -->
            <StackPanel Orientation="Horizontal"
                       HorizontalAlignment="Right"
                       VerticalAlignment="Top"
                       Margin="0,-2,-2,0">
                <!-- Always on Top -->
                <Button Content="📌"
                        Width="24" Height="24"
                        Margin="2,0"
                        Background="{Binding IsAlwaysOnTop, Converter={StaticResource BoolToColorConverter}}"
                        BorderThickness="0"
                        Click="ToggleAlwaysOnTop_Click"
                        ToolTip="Always on Top"
                        Cursor="Hand"
                        FontSize="10"/>

                <!-- Return to Normal -->
                <Button Content="⬅"
                        Width="24" Height="24"
                        Margin="2,0"
                        Background="#3C3C3C"
                        BorderThickness="0"
                        Click="ReturnToNormal_Click"
                        ToolTip="Return to Normal View"
                        Cursor="Hand"
                        FontSize="10"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>